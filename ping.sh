#!/bin/bash

#
# Programa que verifica el TTL de un ping y determina
# el Sistema Operativo basado en los TTL mas comunes
#	Ivan Hernandez Reyes

function errorUso {
# Funcion para la sintaxis

  echo "ERROR: Nombre de host requerido!"
  echo "Sintaxis:   $0 <host>"
  echo -e "Ejemplos: $0 0.0.0.0\n\t  $0 tudominio.com"
  exit 1

}

function hacerPing {
# Funcion principal
		
	ping -c 1   $HOST > ping.txt

if [[   $HOST == "localhost" ]]; then

		pin=$(awk '/ttl/' < ping.txt | cut -d " " -f 7 | cut -d "=" -f 2)	
else 

		pin=$(awk '/ttl/' < ping.txt | cut -d " " -f 6 | cut -d "=" -f 2)	

fi

	#echo $pin

	case $pin in

		64 )
		echo "Es un sistema Linux"
			;;
		128 )
		echo "Es un sistema XXX"
			;;
		255 )
		echo "Es un sistema Cisco (Switch)"
			;;
		116 )
		echo "Es un sistema del Gobierno"
			;;
		53 )
		echo "Es un sistema Google"
			;;
		54 )
		echo "Es un sistema X"
			;;
		57 )
		echo "Es un sistema XX"
			;;
		* )
		echo "Sistema desconocido :("
			;;
	esac
	rm ping.txt
	exit 1
}


[ $# -lt 1 ] || [ $# -gt 1 ] && errorUso ||  HOST=$1

hacerPing


# TTL mas conocidos
#####################################################
# Linux (kernel 2.4 and 2.6)	64	5840
# Googles customized Linux		64	5720
# FreeBSD						64	65535
# Windows XP					128	65535
# Windows 7, 
# Vista and Server 2008			128	8192
# Cisco Router (IOS 12.4)		255	4128
######################################################


#!/usr/bin/python

from scapy.all import *
import sys, getopt


r = '\033[31m' #red
b = '\033[34m' #blue
g = '\033[32m' #green
y = '\033[33m' #yellow
m = '\033[34m' #magenta
c = '\033[36m' #cyan



def usage():
	print ("\t\tEscaner de Red")
	print ("Detecta equipos activos en el rango de ip's")
	print ("\tEjemplos de uso:")
	print ('\t\t"python sweep.py -i eth0 -r 192.168.22.0/24"')
	print ('\t\t"python sweep.py -h"')


def scanea(interface, ip_range):
		conf.verb=0	
		ans,uans=srp(Ether(dst="FF:FF:FF:FF:FF:FF")/ARP(pdst=ip_range),timeout=2,iface=interface,inter=0.1)
		for snd,rcv in ans:
		       print c+rcv.sprintf(r"%Ether.src% - %ARP.psrc%")
		print r+"\nScan complete" 


def main():

	if not len(sys.argv[1:]):
			usage()
	# read the commandline options
	try:
		opts, args = getopt.getopt(sys.argv[1:],"h:i:r",
		["ayuda","","interface","rango IP"])
		for o,a in opts:
			if o == ("-h","--help"):
					usage()
			elif o in ("-i","--interface"):
					interface = sys.argv[2]
			elif o in ("-r", "--rango"):
					ip_range = sys.argv[4]
			else:
					assert False,"No se reconoce opcion :("
		try:
				scanea(interface, ip_range)
		
		except Exception as e:

				print ("Algo salio mal: ", e)
	except getopt.GetoptError as err:
		print str(err)
		usage()

	



main()


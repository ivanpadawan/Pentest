#!/usr/bin/python

# Programa que verifica si un usuario existe en el servidor smtp
# Ivan Hernandez Reyes
#
#

import socket
import sys


def usage():
	
	print ("\tEnumerador de usuarios")
	print ("Modo de uso:")
	print ("\tpython user-smtp.py 'ip o dominio' 'usuario' ")
	print ("")





if len(sys.argv) <= 1:
	usage()
elif len(sys.argv) == 2:
	usage()
elif len(sys.argv) == 3:
	
	try:
			
			buf	 = 1024
			user = sys.argv[2]
			host = sys.argv[1]			
			s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) 
			s.connect((host, 25))
			print (s.recv(buf))
			s.send("HELO test\r\n")
			print (s.recv(buf))
			s.send("VRFY %s\r\n" % user)
			vrfy = s.recv(buf)
			
			if vrfy[0] == 252:
				print ("Usuario valido")
			else:
				print ("Usuario no valido o no tiene permiso")
			s.send("QUIT\r\n")
			s.close()
	
	except Exception as e:
	
		print ("Error: ", e)




